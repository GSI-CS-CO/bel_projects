/*
  crcany version 1.6, 10 February 2017

  Copyright (C) 2014, 2016, 2017 Mark Adler

  This software is provided 'as-is', without any express or implied
  warranty.  In no event will the authors be held liable for any damages
  arising from the use of this software.

  Permission is granted to anyone to use this software for any purpose,
  including commercial applications, and to alter it and redistribute it
  freely, subject to the following restrictions:

  1. The origin of this software must not be misrepresented; you must not
     claim that you wrote the original software. If you use this software
     in a product, an acknowledgment in the product documentation would be
     appreciated but is not required.
  2. Altered source versions must be plainly marked as such, and must not be
     misrepresented as being the original software.
  3. This notice may not be removed or altered from any source distribution.

  Mark Adler
  madler@alumni.caltech.edu
*/

/* Version history:
   1.0  22 Dec 2014  First version
   1.1  15 Jul 2016  Allow negative numbers
                     Move common code to model.[ch]
   1.2  17 Jul 2016  Move generic CRC code to crc.[ch] and crcdbl.[ch]
   1.3  23 Jul 2016  Build xorout into the tables
   1.4  30 Jul 2016  Fix a bug in word-wise table generation
                     Reduce verbosity of testing
   1.5  23 Oct 2016  Improve use of data types and C99 compatibility
                     Add verifications summary message
   1.6  10 Feb 2017  Add new residue parameter parsing and checking

 */

/* Generalized CRC algorithm.  Compute any specified CRC up to 128 bits long.
   Take model inputs from http://reveng.sourceforge.net/crc-catalogue/all.htm
   and verify the check values.  This verifies all 72 CRCs on that page (as of
   the version date above).  The lines on that page that start with "width="
   can be fed verbatim to this program.  The 128-bit limit assumes that
   uintmax_t is 64 bits.  The bit-wise algorithms here will compute CRCs up to
   a width twice that of the typedef'ed word_t type.

   This code also generates and tests table-driven algorithms for high-speed.
   The byte-wise algorithm processes one byte at a time instead of one bit at a
   time, and the word-wise algorithm ingests one word_t at a time.  The table
   driven algorithms here only work for CRCs that fit in a word_t, though they
   could be extended in the same way the bit-wise algorithm is extended here.

   The CRC parameters used in the linked catalogue were originally defined in
   Ross Williams' "A Painless Guide to CRC Error Detection Algorithms", which
   can be found here: http://zlib.net/crc_v3.txt .
 */
#include <stdint.h>
#include "crc8.h"

// This code assumes that unsigned is 4 bytes.

unsigned crc8_bit(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    while (len--) {
        crc ^= *data++;
        for (unsigned k = 0; k < 8; k++)
            crc = crc & 0x80 ? (crc << 1) ^ 0x7 : crc << 1;
    }
    crc &= 0xff;
    return crc;
}

unsigned crc8_rem(unsigned crc, unsigned val, unsigned bits) {
    val &= 0x100 - (0x100 >> bits) ;
    crc ^= val;
    while (bits--)
        crc = crc & 0x80 ? (crc << 1) ^ 0x7 : crc << 1;
    crc &= 0xff;
    return crc;
}

#define table_byte table_word[0]

static unsigned char const table_word[][256] = {
   {0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15, 0x38, 0x3f, 0x36, 0x31, 0x24,
    0x23, 0x2a, 0x2d, 0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65, 0x48, 0x4f,
    0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d, 0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2,
    0xf5, 0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd, 0x90, 0x97, 0x9e, 0x99,
    0x8c, 0x8b, 0x82, 0x85, 0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd, 0xc7,
    0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2, 0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4,
    0xed, 0xea, 0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2, 0x8f, 0x88, 0x81,
    0x86, 0x93, 0x94, 0x9d, 0x9a, 0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a, 0x57, 0x50, 0x59, 0x5e, 0x4b,
    0x4c, 0x45, 0x42, 0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a, 0x89, 0x8e,
    0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c, 0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3,
    0xa4, 0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec, 0xc1, 0xc6, 0xcf, 0xc8,
    0xdd, 0xda, 0xd3, 0xd4, 0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c, 0x51,
    0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44, 0x19, 0x1e, 0x17, 0x10, 0x05, 0x02,
    0x0b, 0x0c, 0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34, 0x4e, 0x49, 0x40,
    0x47, 0x52, 0x55, 0x5c, 0x5b, 0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b, 0x06, 0x01, 0x08, 0x0f, 0x1a,
    0x1d, 0x14, 0x13, 0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb, 0x96, 0x91,
    0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83, 0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc,
    0xcb, 0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3},
   {0x00, 0x15, 0x2a, 0x3f, 0x54, 0x41, 0x7e, 0x6b, 0xa8, 0xbd, 0x82, 0x97, 0xfc,
    0xe9, 0xd6, 0xc3, 0x57, 0x42, 0x7d, 0x68, 0x03, 0x16, 0x29, 0x3c, 0xff, 0xea,
    0xd5, 0xc0, 0xab, 0xbe, 0x81, 0x94, 0xae, 0xbb, 0x84, 0x91, 0xfa, 0xef, 0xd0,
    0xc5, 0x06, 0x13, 0x2c, 0x39, 0x52, 0x47, 0x78, 0x6d, 0xf9, 0xec, 0xd3, 0xc6,
    0xad, 0xb8, 0x87, 0x92, 0x51, 0x44, 0x7b, 0x6e, 0x05, 0x10, 0x2f, 0x3a, 0x5b,
    0x4e, 0x71, 0x64, 0x0f, 0x1a, 0x25, 0x30, 0xf3, 0xe6, 0xd9, 0xcc, 0xa7, 0xb2,
    0x8d, 0x98, 0x0c, 0x19, 0x26, 0x33, 0x58, 0x4d, 0x72, 0x67, 0xa4, 0xb1, 0x8e,
    0x9b, 0xf0, 0xe5, 0xda, 0xcf, 0xf5, 0xe0, 0xdf, 0xca, 0xa1, 0xb4, 0x8b, 0x9e,
    0x5d, 0x48, 0x77, 0x62, 0x09, 0x1c, 0x23, 0x36, 0xa2, 0xb7, 0x88, 0x9d, 0xf6,
    0xe3, 0xdc, 0xc9, 0x0a, 0x1f, 0x20, 0x35, 0x5e, 0x4b, 0x74, 0x61, 0xb6, 0xa3,
    0x9c, 0x89, 0xe2, 0xf7, 0xc8, 0xdd, 0x1e, 0x0b, 0x34, 0x21, 0x4a, 0x5f, 0x60,
    0x75, 0xe1, 0xf4, 0xcb, 0xde, 0xb5, 0xa0, 0x9f, 0x8a, 0x49, 0x5c, 0x63, 0x76,
    0x1d, 0x08, 0x37, 0x22, 0x18, 0x0d, 0x32, 0x27, 0x4c, 0x59, 0x66, 0x73, 0xb0,
    0xa5, 0x9a, 0x8f, 0xe4, 0xf1, 0xce, 0xdb, 0x4f, 0x5a, 0x65, 0x70, 0x1b, 0x0e,
    0x31, 0x24, 0xe7, 0xf2, 0xcd, 0xd8, 0xb3, 0xa6, 0x99, 0x8c, 0xed, 0xf8, 0xc7,
    0xd2, 0xb9, 0xac, 0x93, 0x86, 0x45, 0x50, 0x6f, 0x7a, 0x11, 0x04, 0x3b, 0x2e,
    0xba, 0xaf, 0x90, 0x85, 0xee, 0xfb, 0xc4, 0xd1, 0x12, 0x07, 0x38, 0x2d, 0x46,
    0x53, 0x6c, 0x79, 0x43, 0x56, 0x69, 0x7c, 0x17, 0x02, 0x3d, 0x28, 0xeb, 0xfe,
    0xc1, 0xd4, 0xbf, 0xaa, 0x95, 0x80, 0x14, 0x01, 0x3e, 0x2b, 0x40, 0x55, 0x6a,
    0x7f, 0xbc, 0xa9, 0x96, 0x83, 0xe8, 0xfd, 0xc2, 0xd7},
   {0x00, 0x6b, 0xd6, 0xbd, 0xab, 0xc0, 0x7d, 0x16, 0x51, 0x3a, 0x87, 0xec, 0xfa,
    0x91, 0x2c, 0x47, 0xa2, 0xc9, 0x74, 0x1f, 0x09, 0x62, 0xdf, 0xb4, 0xf3, 0x98,
    0x25, 0x4e, 0x58, 0x33, 0x8e, 0xe5, 0x43, 0x28, 0x95, 0xfe, 0xe8, 0x83, 0x3e,
    0x55, 0x12, 0x79, 0xc4, 0xaf, 0xb9, 0xd2, 0x6f, 0x04, 0xe1, 0x8a, 0x37, 0x5c,
    0x4a, 0x21, 0x9c, 0xf7, 0xb0, 0xdb, 0x66, 0x0d, 0x1b, 0x70, 0xcd, 0xa6, 0x86,
    0xed, 0x50, 0x3b, 0x2d, 0x46, 0xfb, 0x90, 0xd7, 0xbc, 0x01, 0x6a, 0x7c, 0x17,
    0xaa, 0xc1, 0x24, 0x4f, 0xf2, 0x99, 0x8f, 0xe4, 0x59, 0x32, 0x75, 0x1e, 0xa3,
    0xc8, 0xde, 0xb5, 0x08, 0x63, 0xc5, 0xae, 0x13, 0x78, 0x6e, 0x05, 0xb8, 0xd3,
    0x94, 0xff, 0x42, 0x29, 0x3f, 0x54, 0xe9, 0x82, 0x67, 0x0c, 0xb1, 0xda, 0xcc,
    0xa7, 0x1a, 0x71, 0x36, 0x5d, 0xe0, 0x8b, 0x9d, 0xf6, 0x4b, 0x20, 0x0b, 0x60,
    0xdd, 0xb6, 0xa0, 0xcb, 0x76, 0x1d, 0x5a, 0x31, 0x8c, 0xe7, 0xf1, 0x9a, 0x27,
    0x4c, 0xa9, 0xc2, 0x7f, 0x14, 0x02, 0x69, 0xd4, 0xbf, 0xf8, 0x93, 0x2e, 0x45,
    0x53, 0x38, 0x85, 0xee, 0x48, 0x23, 0x9e, 0xf5, 0xe3, 0x88, 0x35, 0x5e, 0x19,
    0x72, 0xcf, 0xa4, 0xb2, 0xd9, 0x64, 0x0f, 0xea, 0x81, 0x3c, 0x57, 0x41, 0x2a,
    0x97, 0xfc, 0xbb, 0xd0, 0x6d, 0x06, 0x10, 0x7b, 0xc6, 0xad, 0x8d, 0xe6, 0x5b,
    0x30, 0x26, 0x4d, 0xf0, 0x9b, 0xdc, 0xb7, 0x0a, 0x61, 0x77, 0x1c, 0xa1, 0xca,
    0x2f, 0x44, 0xf9, 0x92, 0x84, 0xef, 0x52, 0x39, 0x7e, 0x15, 0xa8, 0xc3, 0xd5,
    0xbe, 0x03, 0x68, 0xce, 0xa5, 0x18, 0x73, 0x65, 0x0e, 0xb3, 0xd8, 0x9f, 0xf4,
    0x49, 0x22, 0x34, 0x5f, 0xe2, 0x89, 0x6c, 0x07, 0xba, 0xd1, 0xc7, 0xac, 0x11,
    0x7a, 0x3d, 0x56, 0xeb, 0x80, 0x96, 0xfd, 0x40, 0x2b},
   {0x00, 0x16, 0x2c, 0x3a, 0x58, 0x4e, 0x74, 0x62, 0xb0, 0xa6, 0x9c, 0x8a, 0xe8,
    0xfe, 0xc4, 0xd2, 0x67, 0x71, 0x4b, 0x5d, 0x3f, 0x29, 0x13, 0x05, 0xd7, 0xc1,
    0xfb, 0xed, 0x8f, 0x99, 0xa3, 0xb5, 0xce, 0xd8, 0xe2, 0xf4, 0x96, 0x80, 0xba,
    0xac, 0x7e, 0x68, 0x52, 0x44, 0x26, 0x30, 0x0a, 0x1c, 0xa9, 0xbf, 0x85, 0x93,
    0xf1, 0xe7, 0xdd, 0xcb, 0x19, 0x0f, 0x35, 0x23, 0x41, 0x57, 0x6d, 0x7b, 0x9b,
    0x8d, 0xb7, 0xa1, 0xc3, 0xd5, 0xef, 0xf9, 0x2b, 0x3d, 0x07, 0x11, 0x73, 0x65,
    0x5f, 0x49, 0xfc, 0xea, 0xd0, 0xc6, 0xa4, 0xb2, 0x88, 0x9e, 0x4c, 0x5a, 0x60,
    0x76, 0x14, 0x02, 0x38, 0x2e, 0x55, 0x43, 0x79, 0x6f, 0x0d, 0x1b, 0x21, 0x37,
    0xe5, 0xf3, 0xc9, 0xdf, 0xbd, 0xab, 0x91, 0x87, 0x32, 0x24, 0x1e, 0x08, 0x6a,
    0x7c, 0x46, 0x50, 0x82, 0x94, 0xae, 0xb8, 0xda, 0xcc, 0xf6, 0xe0, 0x31, 0x27,
    0x1d, 0x0b, 0x69, 0x7f, 0x45, 0x53, 0x81, 0x97, 0xad, 0xbb, 0xd9, 0xcf, 0xf5,
    0xe3, 0x56, 0x40, 0x7a, 0x6c, 0x0e, 0x18, 0x22, 0x34, 0xe6, 0xf0, 0xca, 0xdc,
    0xbe, 0xa8, 0x92, 0x84, 0xff, 0xe9, 0xd3, 0xc5, 0xa7, 0xb1, 0x8b, 0x9d, 0x4f,
    0x59, 0x63, 0x75, 0x17, 0x01, 0x3b, 0x2d, 0x98, 0x8e, 0xb4, 0xa2, 0xc0, 0xd6,
    0xec, 0xfa, 0x28, 0x3e, 0x04, 0x12, 0x70, 0x66, 0x5c, 0x4a, 0xaa, 0xbc, 0x86,
    0x90, 0xf2, 0xe4, 0xde, 0xc8, 0x1a, 0x0c, 0x36, 0x20, 0x42, 0x54, 0x6e, 0x78,
    0xcd, 0xdb, 0xe1, 0xf7, 0x95, 0x83, 0xb9, 0xaf, 0x7d, 0x6b, 0x51, 0x47, 0x25,
    0x33, 0x09, 0x1f, 0x64, 0x72, 0x48, 0x5e, 0x3c, 0x2a, 0x10, 0x06, 0xd4, 0xc2,
    0xf8, 0xee, 0x8c, 0x9a, 0xa0, 0xb6, 0x03, 0x15, 0x2f, 0x39, 0x5b, 0x4d, 0x77,
    0x61, 0xb3, 0xa5, 0x9f, 0x89, 0xeb, 0xfd, 0xc7, 0xd1},
   {0x00, 0x62, 0xc4, 0xa6, 0x8f, 0xed, 0x4b, 0x29, 0x19, 0x7b, 0xdd, 0xbf, 0x96,
    0xf4, 0x52, 0x30, 0x32, 0x50, 0xf6, 0x94, 0xbd, 0xdf, 0x79, 0x1b, 0x2b, 0x49,
    0xef, 0x8d, 0xa4, 0xc6, 0x60, 0x02, 0x64, 0x06, 0xa0, 0xc2, 0xeb, 0x89, 0x2f,
    0x4d, 0x7d, 0x1f, 0xb9, 0xdb, 0xf2, 0x90, 0x36, 0x54, 0x56, 0x34, 0x92, 0xf0,
    0xd9, 0xbb, 0x1d, 0x7f, 0x4f, 0x2d, 0x8b, 0xe9, 0xc0, 0xa2, 0x04, 0x66, 0xc8,
    0xaa, 0x0c, 0x6e, 0x47, 0x25, 0x83, 0xe1, 0xd1, 0xb3, 0x15, 0x77, 0x5e, 0x3c,
    0x9a, 0xf8, 0xfa, 0x98, 0x3e, 0x5c, 0x75, 0x17, 0xb1, 0xd3, 0xe3, 0x81, 0x27,
    0x45, 0x6c, 0x0e, 0xa8, 0xca, 0xac, 0xce, 0x68, 0x0a, 0x23, 0x41, 0xe7, 0x85,
    0xb5, 0xd7, 0x71, 0x13, 0x3a, 0x58, 0xfe, 0x9c, 0x9e, 0xfc, 0x5a, 0x38, 0x11,
    0x73, 0xd5, 0xb7, 0x87, 0xe5, 0x43, 0x21, 0x08, 0x6a, 0xcc, 0xae, 0x97, 0xf5,
    0x53, 0x31, 0x18, 0x7a, 0xdc, 0xbe, 0x8e, 0xec, 0x4a, 0x28, 0x01, 0x63, 0xc5,
    0xa7, 0xa5, 0xc7, 0x61, 0x03, 0x2a, 0x48, 0xee, 0x8c, 0xbc, 0xde, 0x78, 0x1a,
    0x33, 0x51, 0xf7, 0x95, 0xf3, 0x91, 0x37, 0x55, 0x7c, 0x1e, 0xb8, 0xda, 0xea,
    0x88, 0x2e, 0x4c, 0x65, 0x07, 0xa1, 0xc3, 0xc1, 0xa3, 0x05, 0x67, 0x4e, 0x2c,
    0x8a, 0xe8, 0xd8, 0xba, 0x1c, 0x7e, 0x57, 0x35, 0x93, 0xf1, 0x5f, 0x3d, 0x9b,
    0xf9, 0xd0, 0xb2, 0x14, 0x76, 0x46, 0x24, 0x82, 0xe0, 0xc9, 0xab, 0x0d, 0x6f,
    0x6d, 0x0f, 0xa9, 0xcb, 0xe2, 0x80, 0x26, 0x44, 0x74, 0x16, 0xb0, 0xd2, 0xfb,
    0x99, 0x3f, 0x5d, 0x3b, 0x59, 0xff, 0x9d, 0xb4, 0xd6, 0x70, 0x12, 0x22, 0x40,
    0xe6, 0x84, 0xad, 0xcf, 0x69, 0x0b, 0x09, 0x6b, 0xcd, 0xaf, 0x86, 0xe4, 0x42,
    0x20, 0x10, 0x72, 0xd4, 0xb6, 0x9f, 0xfd, 0x5b, 0x39},
   {0x00, 0x29, 0x52, 0x7b, 0xa4, 0x8d, 0xf6, 0xdf, 0x4f, 0x66, 0x1d, 0x34, 0xeb,
    0xc2, 0xb9, 0x90, 0x9e, 0xb7, 0xcc, 0xe5, 0x3a, 0x13, 0x68, 0x41, 0xd1, 0xf8,
    0x83, 0xaa, 0x75, 0x5c, 0x27, 0x0e, 0x3b, 0x12, 0x69, 0x40, 0x9f, 0xb6, 0xcd,
    0xe4, 0x74, 0x5d, 0x26, 0x0f, 0xd0, 0xf9, 0x82, 0xab, 0xa5, 0x8c, 0xf7, 0xde,
    0x01, 0x28, 0x53, 0x7a, 0xea, 0xc3, 0xb8, 0x91, 0x4e, 0x67, 0x1c, 0x35, 0x76,
    0x5f, 0x24, 0x0d, 0xd2, 0xfb, 0x80, 0xa9, 0x39, 0x10, 0x6b, 0x42, 0x9d, 0xb4,
    0xcf, 0xe6, 0xe8, 0xc1, 0xba, 0x93, 0x4c, 0x65, 0x1e, 0x37, 0xa7, 0x8e, 0xf5,
    0xdc, 0x03, 0x2a, 0x51, 0x78, 0x4d, 0x64, 0x1f, 0x36, 0xe9, 0xc0, 0xbb, 0x92,
    0x02, 0x2b, 0x50, 0x79, 0xa6, 0x8f, 0xf4, 0xdd, 0xd3, 0xfa, 0x81, 0xa8, 0x77,
    0x5e, 0x25, 0x0c, 0x9c, 0xb5, 0xce, 0xe7, 0x38, 0x11, 0x6a, 0x43, 0xec, 0xc5,
    0xbe, 0x97, 0x48, 0x61, 0x1a, 0x33, 0xa3, 0x8a, 0xf1, 0xd8, 0x07, 0x2e, 0x55,
    0x7c, 0x72, 0x5b, 0x20, 0x09, 0xd6, 0xff, 0x84, 0xad, 0x3d, 0x14, 0x6f, 0x46,
    0x99, 0xb0, 0xcb, 0xe2, 0xd7, 0xfe, 0x85, 0xac, 0x73, 0x5a, 0x21, 0x08, 0x98,
    0xb1, 0xca, 0xe3, 0x3c, 0x15, 0x6e, 0x47, 0x49, 0x60, 0x1b, 0x32, 0xed, 0xc4,
    0xbf, 0x96, 0x06, 0x2f, 0x54, 0x7d, 0xa2, 0x8b, 0xf0, 0xd9, 0x9a, 0xb3, 0xc8,
    0xe1, 0x3e, 0x17, 0x6c, 0x45, 0xd5, 0xfc, 0x87, 0xae, 0x71, 0x58, 0x23, 0x0a,
    0x04, 0x2d, 0x56, 0x7f, 0xa0, 0x89, 0xf2, 0xdb, 0x4b, 0x62, 0x19, 0x30, 0xef,
    0xc6, 0xbd, 0x94, 0xa1, 0x88, 0xf3, 0xda, 0x05, 0x2c, 0x57, 0x7e, 0xee, 0xc7,
    0xbc, 0x95, 0x4a, 0x63, 0x18, 0x31, 0x3f, 0x16, 0x6d, 0x44, 0x9b, 0xb2, 0xc9,
    0xe0, 0x70, 0x59, 0x22, 0x0b, 0xd4, 0xfd, 0x86, 0xaf},
   {0x00, 0xdf, 0xb9, 0x66, 0x75, 0xaa, 0xcc, 0x13, 0xea, 0x35, 0x53, 0x8c, 0x9f,
    0x40, 0x26, 0xf9, 0xd3, 0x0c, 0x6a, 0xb5, 0xa6, 0x79, 0x1f, 0xc0, 0x39, 0xe6,
    0x80, 0x5f, 0x4c, 0x93, 0xf5, 0x2a, 0xa1, 0x7e, 0x18, 0xc7, 0xd4, 0x0b, 0x6d,
    0xb2, 0x4b, 0x94, 0xf2, 0x2d, 0x3e, 0xe1, 0x87, 0x58, 0x72, 0xad, 0xcb, 0x14,
    0x07, 0xd8, 0xbe, 0x61, 0x98, 0x47, 0x21, 0xfe, 0xed, 0x32, 0x54, 0x8b, 0x45,
    0x9a, 0xfc, 0x23, 0x30, 0xef, 0x89, 0x56, 0xaf, 0x70, 0x16, 0xc9, 0xda, 0x05,
    0x63, 0xbc, 0x96, 0x49, 0x2f, 0xf0, 0xe3, 0x3c, 0x5a, 0x85, 0x7c, 0xa3, 0xc5,
    0x1a, 0x09, 0xd6, 0xb0, 0x6f, 0xe4, 0x3b, 0x5d, 0x82, 0x91, 0x4e, 0x28, 0xf7,
    0x0e, 0xd1, 0xb7, 0x68, 0x7b, 0xa4, 0xc2, 0x1d, 0x37, 0xe8, 0x8e, 0x51, 0x42,
    0x9d, 0xfb, 0x24, 0xdd, 0x02, 0x64, 0xbb, 0xa8, 0x77, 0x11, 0xce, 0x8a, 0x55,
    0x33, 0xec, 0xff, 0x20, 0x46, 0x99, 0x60, 0xbf, 0xd9, 0x06, 0x15, 0xca, 0xac,
    0x73, 0x59, 0x86, 0xe0, 0x3f, 0x2c, 0xf3, 0x95, 0x4a, 0xb3, 0x6c, 0x0a, 0xd5,
    0xc6, 0x19, 0x7f, 0xa0, 0x2b, 0xf4, 0x92, 0x4d, 0x5e, 0x81, 0xe7, 0x38, 0xc1,
    0x1e, 0x78, 0xa7, 0xb4, 0x6b, 0x0d, 0xd2, 0xf8, 0x27, 0x41, 0x9e, 0x8d, 0x52,
    0x34, 0xeb, 0x12, 0xcd, 0xab, 0x74, 0x67, 0xb8, 0xde, 0x01, 0xcf, 0x10, 0x76,
    0xa9, 0xba, 0x65, 0x03, 0xdc, 0x25, 0xfa, 0x9c, 0x43, 0x50, 0x8f, 0xe9, 0x36,
    0x1c, 0xc3, 0xa5, 0x7a, 0x69, 0xb6, 0xd0, 0x0f, 0xf6, 0x29, 0x4f, 0x90, 0x83,
    0x5c, 0x3a, 0xe5, 0x6e, 0xb1, 0xd7, 0x08, 0x1b, 0xc4, 0xa2, 0x7d, 0x84, 0x5b,
    0x3d, 0xe2, 0xf1, 0x2e, 0x48, 0x97, 0xbd, 0x62, 0x04, 0xdb, 0xc8, 0x17, 0x71,
    0xae, 0x57, 0x88, 0xee, 0x31, 0x22, 0xfd, 0x9b, 0x44},
   {0x00, 0x13, 0x26, 0x35, 0x4c, 0x5f, 0x6a, 0x79, 0x98, 0x8b, 0xbe, 0xad, 0xd4,
    0xc7, 0xf2, 0xe1, 0x37, 0x24, 0x11, 0x02, 0x7b, 0x68, 0x5d, 0x4e, 0xaf, 0xbc,
    0x89, 0x9a, 0xe3, 0xf0, 0xc5, 0xd6, 0x6e, 0x7d, 0x48, 0x5b, 0x22, 0x31, 0x04,
    0x17, 0xf6, 0xe5, 0xd0, 0xc3, 0xba, 0xa9, 0x9c, 0x8f, 0x59, 0x4a, 0x7f, 0x6c,
    0x15, 0x06, 0x33, 0x20, 0xc1, 0xd2, 0xe7, 0xf4, 0x8d, 0x9e, 0xab, 0xb8, 0xdc,
    0xcf, 0xfa, 0xe9, 0x90, 0x83, 0xb6, 0xa5, 0x44, 0x57, 0x62, 0x71, 0x08, 0x1b,
    0x2e, 0x3d, 0xeb, 0xf8, 0xcd, 0xde, 0xa7, 0xb4, 0x81, 0x92, 0x73, 0x60, 0x55,
    0x46, 0x3f, 0x2c, 0x19, 0x0a, 0xb2, 0xa1, 0x94, 0x87, 0xfe, 0xed, 0xd8, 0xcb,
    0x2a, 0x39, 0x0c, 0x1f, 0x66, 0x75, 0x40, 0x53, 0x85, 0x96, 0xa3, 0xb0, 0xc9,
    0xda, 0xef, 0xfc, 0x1d, 0x0e, 0x3b, 0x28, 0x51, 0x42, 0x77, 0x64, 0xbf, 0xac,
    0x99, 0x8a, 0xf3, 0xe0, 0xd5, 0xc6, 0x27, 0x34, 0x01, 0x12, 0x6b, 0x78, 0x4d,
    0x5e, 0x88, 0x9b, 0xae, 0xbd, 0xc4, 0xd7, 0xe2, 0xf1, 0x10, 0x03, 0x36, 0x25,
    0x5c, 0x4f, 0x7a, 0x69, 0xd1, 0xc2, 0xf7, 0xe4, 0x9d, 0x8e, 0xbb, 0xa8, 0x49,
    0x5a, 0x6f, 0x7c, 0x05, 0x16, 0x23, 0x30, 0xe6, 0xf5, 0xc0, 0xd3, 0xaa, 0xb9,
    0x8c, 0x9f, 0x7e, 0x6d, 0x58, 0x4b, 0x32, 0x21, 0x14, 0x07, 0x63, 0x70, 0x45,
    0x56, 0x2f, 0x3c, 0x09, 0x1a, 0xfb, 0xe8, 0xdd, 0xce, 0xb7, 0xa4, 0x91, 0x82,
    0x54, 0x47, 0x72, 0x61, 0x18, 0x0b, 0x3e, 0x2d, 0xcc, 0xdf, 0xea, 0xf9, 0x80,
    0x93, 0xa6, 0xb5, 0x0d, 0x1e, 0x2b, 0x38, 0x41, 0x52, 0x67, 0x74, 0x95, 0x86,
    0xb3, 0xa0, 0xd9, 0xca, 0xff, 0xec, 0x3a, 0x29, 0x1c, 0x0f, 0x76, 0x65, 0x50,
    0x43, 0xa2, 0xb1, 0x84, 0x97, 0xee, 0xfd, 0xc8, 0xdb}
};

unsigned crc8_byte(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    crc &= 0xff;
    while (len--)
        crc = table_byte[crc ^ *data++];
    return crc;
}

// This code assumes that integers are stored little-endian.

unsigned crc8_word(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    crc &= 0xff;
    while (len && ((ptrdiff_t)data & 0x7)) {
        crc = table_byte[crc ^ *data++];
        len--;
    }
    if (len >= 8) {
        do {
            uintmax_t word = crc ^ *(uintmax_t const *)data;
            crc = table_word[7][word & 0xff] ^
                  table_word[6][(word >> 8) & 0xff] ^
                  table_word[5][(word >> 16) & 0xff] ^
                  table_word[4][(word >> 24) & 0xff] ^
                  table_word[3][(word >> 32) & 0xff] ^
                  table_word[2][(word >> 40) & 0xff] ^
                  table_word[1][(word >> 48) & 0xff] ^
                  table_word[0][word >> 56];
            data += 8;
            len -= 8;
        } while (len >= 8);
    }
    while (len--)
        crc = table_byte[crc ^ *data++];
    return crc;
}
