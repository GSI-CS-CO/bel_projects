# Copyright (C) 2019 GSI Helmholtz Centre for Heavy Ion Research GmbH
#
# Build instructions for the bel_projects project using Travis CI
#
# Author Enkhbold Ochirsuren <E.Ochirsuren@gsi.de>
arch:
  - amd64
  - arm64
language: cpp
os: linux
dist: xenial
sudo: required

git:
  submodules: false

compiler:
- gcc

# show CPU info, update package manager
before_install:
- lscpu
- apt-get update
- apt-get upgrade

# install required packages
install:
- apt-get install build-essential --install-suggests -y
- apt-get install docbook-utils -y
- apt-get install libreadline-dev -y
- apt-get install linux-headers-$(uname -r) -y
- apt-get install sdcc fxload -y
- apt-get install autotools-dev -y
- apt-get install automake -y
- apt-get install libtool -y
- apt-get install libglibmm-2.4 -y
- apt-get install libglib2.0 -y
- apt-get install xsltproc -y
- apt-get install libboost-dev -y
- update-ca-certificates

# update submodules
before_script:
- export GIT_SSL_NO_VERIFY=true
- git config http.sslVerify false
- git config --global http.sslverify "false"
- make

# build projects and install
script:
- make etherbone
- make tools
- make firmware
- make driver
- sudo make install

# build saftlib and install (optional)
after_success:
- make saftlib -j$(nproc)
- sudo make saftlib-install
