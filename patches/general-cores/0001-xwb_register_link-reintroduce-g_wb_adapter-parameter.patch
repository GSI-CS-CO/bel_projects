From 9217c542b7ae1c91bec0bfb7acf0bb558290630b Mon Sep 17 00:00:00 2001
From: "A. Hahn" <a.hahn@gsi.de>
Date: Fri, 17 Oct 2025 15:06:30 +0200
Subject: [PATCH] xwb_register_link: reintroduce g_wb_adapter parameter

---
 .../wb_register/xwb_register_link.vhd         | 70 +++++++++++--------
 modules/wishbone/wishbone_pkg.vhd             |  1 +
 2 files changed, 40 insertions(+), 31 deletions(-)

diff --git a/modules/wishbone/wb_register/xwb_register_link.vhd b/modules/wishbone/wb_register/xwb_register_link.vhd
index 94d8394..120fd9e 100644
--- a/modules/wishbone/wb_register/xwb_register_link.vhd
+++ b/modules/wishbone/wb_register/xwb_register_link.vhd
@@ -63,37 +63,45 @@ begin
 
   -- xwb_register_link only works with PIPELINED interfaces.
   -- We convert from/to PIPELINED to enforce this.
-  wb_slave_adapter_in: wb_slave_adapter
-    generic map (
-      g_master_use_struct  => TRUE,
-      g_slave_use_struct   => TRUE,
-      g_slave_mode         => g_WB_IN_MODE,
-      g_slave_granularity  => g_WB_IN_GRANULARITY,
-      g_master_mode        => CLASSIC,
-      g_master_granularity => BYTE)
-    port map (
-      clk_sys_i  => clk_sys_i,
-      rst_n_i    => rst_n_i,
-      slave_i    => slave_i,
-      slave_o    => slave_o,
-      master_i   => slave_out,
-      master_o   => slave_in);
-
-  wb_slave_adapter_out: wb_slave_adapter
-    generic map (
-      g_master_use_struct  => TRUE,
-      g_slave_use_struct   => TRUE,
-      g_slave_mode         => CLASSIC,
-      g_slave_granularity  => BYTE,
-      g_master_mode        => g_WB_OUT_MODE,
-      g_master_granularity => g_WB_OUT_GRANULARITY)
-    port map (
-      clk_sys_i  => clk_sys_i,
-      rst_n_i    => rst_n_i,
-      slave_i    => master_out,
-      slave_o    => master_in,
-      master_i   => master_i,
-      master_o   => master_o);
+  g_wb_adapter_n : if not g_wb_adapter generate
+    slave_o   <= slave_out;
+    slave_in  <= slave_i;
+    master_o  <= master_out;
+    master_in <= master_i;
+  end generate;
+  g_wb_adapter_y : if g_wb_adapter generate
+    wb_slave_adapter_in: wb_slave_adapter
+      generic map (
+        g_master_use_struct  => TRUE,
+        g_slave_use_struct   => TRUE,
+        g_slave_mode         => g_WB_IN_MODE,
+        g_slave_granularity  => g_WB_IN_GRANULARITY,
+        g_master_mode        => CLASSIC,
+        g_master_granularity => BYTE)
+      port map (
+        clk_sys_i  => clk_sys_i,
+        rst_n_i    => rst_n_i,
+        slave_i    => slave_i,
+        slave_o    => slave_o,
+        master_i   => slave_out,
+        master_o   => slave_in);
+
+    wb_slave_adapter_out: wb_slave_adapter
+      generic map (
+        g_master_use_struct  => TRUE,
+        g_slave_use_struct   => TRUE,
+        g_slave_mode         => CLASSIC,
+        g_slave_granularity  => BYTE,
+        g_master_mode        => g_WB_OUT_MODE,
+        g_master_granularity => g_WB_OUT_GRANULARITY)
+      port map (
+        clk_sys_i  => clk_sys_i,
+        rst_n_i    => rst_n_i,
+        slave_i    => master_out,
+        slave_o    => master_in,
+        master_i   => master_i,
+        master_o   => master_o);
+  end generate;
 
   sp : wb_skidpad
   generic map(
diff --git a/modules/wishbone/wishbone_pkg.vhd b/modules/wishbone/wishbone_pkg.vhd
index 7888b2c..fd3d6fd 100644
--- a/modules/wishbone/wishbone_pkg.vhd
+++ b/modules/wishbone/wishbone_pkg.vhd
@@ -445,6 +445,7 @@ package wishbone_pkg is
 
   component xwb_register_link  -- puts a register of delay between crossbars
     generic (
+      g_wb_adapter         : boolean                        := true;
       g_WB_IN_MODE         : t_wishbone_interface_mode      := PIPELINED;
       g_WB_IN_GRANULARITY  : t_wishbone_address_granularity := BYTE;
       g_WB_OUT_MODE        : t_wishbone_interface_mode      := PIPELINED;
-- 
2.43.0

